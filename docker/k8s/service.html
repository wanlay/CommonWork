<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>service | my-site</title>
    <meta name="description" content="mysite">
    <link rel="icon" href="/document/favicon.ico">
    
    <link rel="preload" href="/document/assets/css/styles.5eb717b1.css" as="style"><link rel="preload" href="/document/assets/js/app.5eb717b1.js" as="script"><link rel="preload" href="/document/assets/js/11.51601390.js" as="script"><link rel="prefetch" href="/document/assets/js/1.ddf42c38.js"><link rel="prefetch" href="/document/assets/js/10.aca434fd.js"><link rel="prefetch" href="/document/assets/js/12.ad28f615.js"><link rel="prefetch" href="/document/assets/js/13.ac59c3d1.js"><link rel="prefetch" href="/document/assets/js/14.9a885008.js"><link rel="prefetch" href="/document/assets/js/15.f3655483.js"><link rel="prefetch" href="/document/assets/js/16.fd334191.js"><link rel="prefetch" href="/document/assets/js/17.7d7907a4.js"><link rel="prefetch" href="/document/assets/js/18.509fb0d1.js"><link rel="prefetch" href="/document/assets/js/19.849def23.js"><link rel="prefetch" href="/document/assets/js/2.68be4103.js"><link rel="prefetch" href="/document/assets/js/20.a45e76c6.js"><link rel="prefetch" href="/document/assets/js/21.6708f267.js"><link rel="prefetch" href="/document/assets/js/22.96d5c709.js"><link rel="prefetch" href="/document/assets/js/23.d43e6b88.js"><link rel="prefetch" href="/document/assets/js/24.6adcba5c.js"><link rel="prefetch" href="/document/assets/js/25.ebd3b924.js"><link rel="prefetch" href="/document/assets/js/26.4040aa58.js"><link rel="prefetch" href="/document/assets/js/27.50d8fb00.js"><link rel="prefetch" href="/document/assets/js/28.35f30a1a.js"><link rel="prefetch" href="/document/assets/js/29.86a6c76b.js"><link rel="prefetch" href="/document/assets/js/3.27896c98.js"><link rel="prefetch" href="/document/assets/js/30.a8f2d9ad.js"><link rel="prefetch" href="/document/assets/js/31.aa2e6fe8.js"><link rel="prefetch" href="/document/assets/js/32.c8127cc3.js"><link rel="prefetch" href="/document/assets/js/33.ab0c0d25.js"><link rel="prefetch" href="/document/assets/js/34.c54d6fbf.js"><link rel="prefetch" href="/document/assets/js/35.b062d65d.js"><link rel="prefetch" href="/document/assets/js/36.59518d28.js"><link rel="prefetch" href="/document/assets/js/37.d20c65a1.js"><link rel="prefetch" href="/document/assets/js/38.fb2890b5.js"><link rel="prefetch" href="/document/assets/js/39.ff39d369.js"><link rel="prefetch" href="/document/assets/js/4.b23a15d0.js"><link rel="prefetch" href="/document/assets/js/40.51730ac4.js"><link rel="prefetch" href="/document/assets/js/41.4d899e1c.js"><link rel="prefetch" href="/document/assets/js/42.12d30c89.js"><link rel="prefetch" href="/document/assets/js/43.0542e2b0.js"><link rel="prefetch" href="/document/assets/js/44.e6ce2834.js"><link rel="prefetch" href="/document/assets/js/45.aa0bfb53.js"><link rel="prefetch" href="/document/assets/js/5.9aeab741.js"><link rel="prefetch" href="/document/assets/js/6.c2ff2458.js"><link rel="prefetch" href="/document/assets/js/7.ac6af82a.js"><link rel="prefetch" href="/document/assets/js/8.d108ed4a.js"><link rel="prefetch" href="/document/assets/js/9.6d42ccf6.js">
    <link rel="stylesheet" href="/document/assets/css/styles.5eb717b1.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/document/" class="home-link router-link-active"><!----><span class="site-name">
      my-site
    </span></a><div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""><!----></div><nav class="nav-links can-hide"><div class="nav-item"><a href="/document/linux/" class="nav-link">linux</a></div><div class="nav-item"><a href="/document/docker/" class="nav-link router-link-active">docker</a></div><div class="nav-item"><a href="/document/language/" class="nav-link">语言</a></div><div class="nav-item"><a href="/document/windows/" class="nav-link">windows</a></div><div class="nav-item"><a href="/document/others/" class="nav-link">其他</a></div><a href="https://github.com/wanlay/document" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header><div class="sidebar-mask"></div><div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/document/linux/" class="nav-link">linux</a></div><div class="nav-item"><a href="/document/docker/" class="nav-link router-link-active">docker</a></div><div class="nav-item"><a href="/document/language/" class="nav-link">语言</a></div><div class="nav-item"><a href="/document/windows/" class="nav-link">windows</a></div><div class="nav-item"><a href="/document/others/" class="nav-link">其他</a></div><a href="https://github.com/wanlay/document" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav><ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading"><span>基础</span><!----></p><ul class="sidebar-group-items"><li><a href="/document/docker/common/install.html" class="sidebar-link">安装</a></li><li><a href="/document/docker/common/tips.html" class="sidebar-link">tips</a></li><li><a href="/document/docker/common/github.html" class="sidebar-link">Docker Cheat Sheet</a></li><li><a href="/document/docker/common/container.html" class="sidebar-link">ELK</a></li><li><a href="/document/docker/common/Dockerfile.html" class="sidebar-link">Dockerfile</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading open"><span>k8s</span><!----></p><ul class="sidebar-group-items"><li><a href="/document/docker/k8s/install.html" class="sidebar-link">安装</a></li><li><a href="/document/docker/k8s/cmd.html" class="sidebar-link">CMD</a></li><li><a href="/document/docker/k8s/service.html" class="active sidebar-link">service</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/document/docker/k8s/service.html#nexus" class="sidebar-link">nexus</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/document/docker/k8s/service.html#deployment" class="sidebar-link">deployment</a></li><li class="sidebar-sub-header"><a href="/document/docker/k8s/service.html#ingress" class="sidebar-link">ingress</a></li><li class="sidebar-sub-header"><a href="/document/docker/k8s/service.html#service-2" class="sidebar-link">service</a></li></ul></li><li class="sidebar-sub-header"><a href="/document/docker/k8s/service.html#nginx" class="sidebar-link">nginx</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/document/docker/k8s/service.html#configmap" class="sidebar-link">configmap</a></li><li class="sidebar-sub-header"><a href="/document/docker/k8s/service.html#deployment-2" class="sidebar-link">deployment</a></li><li class="sidebar-sub-header"><a href="/document/docker/k8s/service.html#service-3" class="sidebar-link">service</a></li></ul></li><li class="sidebar-sub-header"><a href="/document/docker/k8s/service.html#ssr" class="sidebar-link">ssr</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/document/docker/k8s/service.html#deployment-3" class="sidebar-link">deployment</a></li><li class="sidebar-sub-header"><a href="/document/docker/k8s/service.html#service-4" class="sidebar-link">service</a></li></ul></li></ul></li></ul></div></li></ul></div><div class="page"><div class="content"><h1 id="service"><a href="#service" aria-hidden="true" class="header-anchor">#</a> service</h1><h2 id="nexus"><a href="#nexus" aria-hidden="true" class="header-anchor">#</a> nexus</h2><h3 id="deployment"><a href="#deployment" aria-hidden="true" class="header-anchor">#</a> deployment</h3><div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> extensions/v1beta1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> nexus
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> default

<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token key atrule">strategy</span><span class="token punctuation">:</span>
    <span class="token key atrule">type</span><span class="token punctuation">:</span> Recreate
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">app</span><span class="token punctuation">:</span> nexus
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> nexus
          <span class="token key atrule">image</span><span class="token punctuation">:</span> sonatype/nexus3<span class="token punctuation">:</span>3.3.1
          <span class="token key atrule">imagePullPolicy</span><span class="token punctuation">:</span> IfNotPresent
          <span class="token key atrule">ports</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">8081</span>
            <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">5000</span>
          <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> nexus<span class="token punctuation">-</span>data
              <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /nexus<span class="token punctuation">-</span>data
          <span class="token key atrule">resources</span><span class="token punctuation">:</span>
            <span class="token key atrule">requests</span><span class="token punctuation">:</span>
              <span class="token key atrule">cpu</span><span class="token punctuation">:</span> 440m
              <span class="token key atrule">memory</span><span class="token punctuation">:</span> 3.3Gi
            <span class="token key atrule">limits</span><span class="token punctuation">:</span>
              <span class="token key atrule">cpu</span><span class="token punctuation">:</span> 440m
              <span class="token key atrule">memory</span><span class="token punctuation">:</span> 3.3Gi
      <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> nexus<span class="token punctuation">-</span>data
<span class="token comment">#          azureFile:</span>
<span class="token comment">#            secretName: azure-file-storage-secret</span>
<span class="token comment">#            shareName: nexus-data</span>

<span class="token comment">#      readinessProbe:</span>
<span class="token comment">#        httpGet:</span>
<span class="token comment">#          path: /service/siesta/rest/v1/script</span>
<span class="token comment">#          port: 8081</span>
<span class="token comment">#          httpHeaders:</span>
<span class="token comment">#            - name: Authorization</span>
<span class="token comment">#              # The authorization token is simply the base64 encoding of the `healthprobe` user's credentials:</span>
<span class="token comment">#              # $ echo -n user:password | base64</span>
<span class="token comment">#              value: Basic dXNlcjpwYXNzd29yZA==</span>
<span class="token comment">#        initialDelaySeconds: 900</span>
<span class="token comment">#        timeoutSeconds: 60</span>
<span class="token comment">#      livenessProbe:</span>
<span class="token comment">#        httpGet:</span>
<span class="token comment">#          path: /service/siesta/rest/v1/script</span>
<span class="token comment">#          port: 8081</span>
<span class="token comment">#          httpHeaders:</span>
<span class="token comment">#            - name: Authorization</span>
<span class="token comment">#              value: Basic dXNlcjpwYXNzd29yZA==</span>
<span class="token comment">#        initialDelaySeconds: 900</span>
<span class="token comment">#        timeoutSeconds: 60</span>
</code></pre></div><h3 id="ingress"><a href="#ingress" aria-hidden="true" class="header-anchor">#</a> ingress</h3><div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> extensions/v1beta1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Ingress
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> nexus
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> default
  <span class="token key atrule">annotations</span><span class="token punctuation">:</span>
    <span class="token key atrule">kubernetes.io/ingress.class</span><span class="token punctuation">:</span> <span class="token string">&quot;nginx&quot;</span>
    <span class="token key atrule">kubernetes.io/tls-acme</span><span class="token punctuation">:</span> <span class="token string">&quot;true&quot;</span>

<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">tls</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">hosts</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> nexus.example.com
      <span class="token key atrule">secretName</span><span class="token punctuation">:</span> nexus<span class="token punctuation">-</span>tls
  <span class="token key atrule">rules</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">host</span><span class="token punctuation">:</span> nexus.example.com
      <span class="token key atrule">http</span><span class="token punctuation">:</span>
        <span class="token key atrule">paths</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">path</span><span class="token punctuation">:</span> /
          <span class="token key atrule">backend</span><span class="token punctuation">:</span>
            <span class="token key atrule">serviceName</span><span class="token punctuation">:</span> internal<span class="token punctuation">-</span>proxy
            <span class="token key atrule">servicePort</span><span class="token punctuation">:</span> <span class="token number">80</span>
</code></pre></div><h3 id="service-2"><a href="#service-2" aria-hidden="true" class="header-anchor">#</a> service</h3><div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> nexus
  <span class="token key atrule">name</span><span class="token punctuation">:</span> nexus
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> default
  <span class="token key atrule">selfLink</span><span class="token punctuation">:</span> /api/v1/namespaces/default/services/nexus

<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> http
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">80</span>
    <span class="token key atrule">targetPort</span><span class="token punctuation">:</span> <span class="token number">8081</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> docker
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">5000</span>
    <span class="token key atrule">targetPort</span><span class="token punctuation">:</span> <span class="token number">5000</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> nexus
  <span class="token key atrule">type</span><span class="token punctuation">:</span> ClusterIP
</code></pre></div><h2 id="nginx"><a href="#nginx" aria-hidden="true" class="header-anchor">#</a> nginx</h2><h3 id="configmap"><a href="#configmap" aria-hidden="true" class="header-anchor">#</a> configmap</h3><div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">data</span><span class="token punctuation">:</span>
  <span class="token key atrule">nginx.conf</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
    worker_processes auto;</span>

    events <span class="token punctuation">{</span>
        worker_connections 1024;
    <span class="token punctuation">}</span>

    http <span class="token punctuation">{</span>
        error_log /var/log/nginx/error.log warn;
        access_log  /dev/null;
        proxy_intercept_errors off;
        proxy_send_timeout 120;
        proxy_read_timeout 300;

        upstream nexus <span class="token punctuation">{</span>
            server nexus<span class="token punctuation">:</span>80;
        <span class="token punctuation">}</span>

        upstream registry <span class="token punctuation">{</span>
            server nexus<span class="token punctuation">:</span>5000;
        <span class="token punctuation">}</span>

        server <span class="token punctuation">{</span>
            listen 80;
            server_name nexus.example.com;

            keepalive_timeout  5 5;
            proxy_buffering    off;

            <span class="token comment"># allow large uploads</span>
            client_max_body_size 1G;

            location / <span class="token punctuation">{</span>
            <span class="token comment"># redirect to docker registry</span>
            if ($http_user_agent ~ docker ) <span class="token punctuation">{</span>
                proxy_pass http<span class="token punctuation">:</span>//registry;
            <span class="token punctuation">}</span>
            proxy_pass http<span class="token punctuation">:</span>//nexus;
            proxy_set_header Host $host;
            proxy_set_header X<span class="token punctuation">-</span>Real<span class="token punctuation">-</span>IP $remote_addr;
            proxy_set_header X<span class="token punctuation">-</span>Forwarded<span class="token punctuation">-</span>For $proxy_add_x_forwarded_for;
            proxy_set_header X<span class="token punctuation">-</span>Forwarded<span class="token punctuation">-</span>Proto &quot;https&quot;;
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ConfigMap
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">creationTimestamp</span><span class="token punctuation">:</span> <span class="token null important">null</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> internal<span class="token punctuation">-</span>proxy<span class="token punctuation">-</span>conf
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> default
  <span class="token key atrule">selfLink</span><span class="token punctuation">:</span> /api/v1/namespaces/default/configmaps/internal<span class="token punctuation">-</span>proxy<span class="token punctuation">-</span>conf
</code></pre></div><h3 id="deployment-2"><a href="#deployment-2" aria-hidden="true" class="header-anchor">#</a> deployment</h3><div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> extensions/v1beta1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> internal<span class="token punctuation">-</span>proxy
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> default

<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">proxy</span><span class="token punctuation">:</span> internal
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx
          <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx<span class="token punctuation">:</span>1.11<span class="token punctuation">-</span>alpine
          <span class="token key atrule">imagePullPolicy</span><span class="token punctuation">:</span> IfNotPresent
          <span class="token key atrule">lifecycle</span><span class="token punctuation">:</span>
            <span class="token key atrule">preStop</span><span class="token punctuation">:</span>
              <span class="token key atrule">exec</span><span class="token punctuation">:</span>
                <span class="token key atrule">command</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;/usr/sbin/nginx&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;-s&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;quit&quot;</span><span class="token punctuation">]</span>
          <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> internal<span class="token punctuation">-</span>proxy<span class="token punctuation">-</span>conf
              <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /etc/nginx/
          <span class="token key atrule">env</span><span class="token punctuation">:</span>
            <span class="token comment"># This is a workaround to easily force a restart by incrementing the value (numbers must be quoted)</span>
            <span class="token comment"># NGINX needs to be restarted for configuration changes, especially DNS changes, to be detected</span>
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> RESTART_
              <span class="token key atrule">value</span><span class="token punctuation">:</span> <span class="token string">&quot;0&quot;</span>
      <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> internal<span class="token punctuation">-</span>proxy<span class="token punctuation">-</span>conf
          <span class="token key atrule">configMap</span><span class="token punctuation">:</span>
            <span class="token key atrule">name</span><span class="token punctuation">:</span> internal<span class="token punctuation">-</span>proxy<span class="token punctuation">-</span>conf
            <span class="token key atrule">items</span><span class="token punctuation">:</span>
              <span class="token punctuation">-</span> <span class="token key atrule">key</span><span class="token punctuation">:</span> nginx.conf
                <span class="token key atrule">path</span><span class="token punctuation">:</span> nginx.conf
</code></pre></div><h3 id="service-3"><a href="#service-3" aria-hidden="true" class="header-anchor">#</a> service</h3><div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> internal<span class="token punctuation">-</span>proxy
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> default

<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">proxy</span><span class="token punctuation">:</span> internal
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> http
      <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">80</span>
      <span class="token key atrule">targetPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> https
      <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">443</span>
      <span class="token key atrule">targetPort</span><span class="token punctuation">:</span> <span class="token number">443</span>
  <span class="token key atrule">type</span><span class="token punctuation">:</span> ClusterIP
</code></pre></div><h2 id="ssr"><a href="#ssr" aria-hidden="true" class="header-anchor">#</a> ssr</h2><h3 id="deployment-3"><a href="#deployment-3" aria-hidden="true" class="header-anchor">#</a> deployment</h3><div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> extensions/v1beta1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">creationTimestamp</span><span class="token punctuation">:</span> <span class="token null important">null</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">io.kompose.service</span><span class="token punctuation">:</span> ssr
    <span class="token key atrule">app</span><span class="token punctuation">:</span> ssr
  <span class="token key atrule">name</span><span class="token punctuation">:</span> ssr
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token key atrule">strategy</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">creationTimestamp</span><span class="token punctuation">:</span> <span class="token null important">null</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">io.kompose.service</span><span class="token punctuation">:</span> ssr
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">env</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> METHOD
          <span class="token key atrule">value</span><span class="token punctuation">:</span> aes<span class="token punctuation">-</span>256<span class="token punctuation">-</span>cfb
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> OBFS
          <span class="token key atrule">value</span><span class="token punctuation">:</span> tls1.2_ticket_auth
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> PASSWORD
          <span class="token key atrule">value</span><span class="token punctuation">:</span> gcssr123./
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> PROTOCOL
          <span class="token key atrule">value</span><span class="token punctuation">:</span> auth_sha1_v4
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> SERVER_ADDR
          <span class="token key atrule">value</span><span class="token punctuation">:</span> 0.0.0.0
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> SERVER_PORT
          <span class="token key atrule">value</span><span class="token punctuation">:</span> <span class="token string">&quot;8388&quot;</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> DNS_ADDR
          <span class="token key atrule">value</span><span class="token punctuation">:</span> 10.190.49.51
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> DNS_ADDR_2 
          <span class="token key atrule">value</span><span class="token punctuation">:</span> 
        <span class="token key atrule">image</span><span class="token punctuation">:</span> breakwa11/shadowsocksr
        <span class="token key atrule">name</span><span class="token punctuation">:</span> ssr
        <span class="token key atrule">ports</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">8388</span>
        <span class="token key atrule">resources</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
      <span class="token key atrule">restartPolicy</span><span class="token punctuation">:</span> Always
<span class="token key atrule">status</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><h3 id="service-4"><a href="#service-4" aria-hidden="true" class="header-anchor">#</a> service</h3><div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> ssr
    <span class="token key atrule">io.kompose.service</span><span class="token punctuation">:</span> ssr
  <span class="token key atrule">name</span><span class="token punctuation">:</span> ssr
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> default
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">externalTrafficPolicy</span><span class="token punctuation">:</span> Cluster
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8388</span>
    <span class="token key atrule">protocol</span><span class="token punctuation">:</span> TCP
    <span class="token key atrule">targetPort</span><span class="token punctuation">:</span> <span class="token number">8388</span>
    <span class="token key atrule">nodePort</span><span class="token punctuation">:</span> <span class="token number">32388</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">io.kompose.service</span><span class="token punctuation">:</span> ssr
  <span class="token key atrule">type</span><span class="token punctuation">:</span> LoadBalancer
<span class="token key atrule">status</span><span class="token punctuation">:</span>
  <span class="token key atrule">loadBalancer</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div></div><div class="page-edit"><div class="edit-link"><a href="https://github.com/wanlay/document/edit/master/docs/docker/k8s/service.md" target="_blank" rel="noopener noreferrer">在 GitHub 上编辑此页</a><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div><div class="last-updated"><span class="prefix">上次更新: </span><span class="time">8/14/2018, 1:36:40 AM</span></div></div><div class="page-nav"><p class="inner"><span class="prev">
        ← <a href="/document/docker/k8s/cmd.html" class="prev">
          CMD
        </a></span><!----></p></div></div></div></div>
    <script src="/document/assets/js/app.5eb717b1.js" defer></script><script src="/document/assets/js/11.51601390.js" defer></script>
  </body>
</html>
