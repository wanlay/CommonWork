(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{145:function(a,t,s){"use strict";s.r(t);var n=s(0),e=Object(n.a)({},(function(){var a=this.$createElement;this._self._c;return this._m(0)}),[function(){var a=this,t=a.$createElement,s=a._self._c||t;return s("div",{staticClass:"content"},[s("h2",{attrs:{id:"elk"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#elk","aria-hidden":"true"}},[a._v("#")]),a._v(" ELK")]),s("p",[a._v("使用sebp/elk镜像"),s("br"),a._v("\n运行时，日志报")]),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("max virtual memory areas vm.max_map_count [65530] likely too low, increase to at least [262144]\n")])])]),s("p",[a._v("需增加宿主机的内存,至少需要2G")]),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 设置")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" sysctl -w vm.max_map_count"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("262144")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 查看")]),a._v("\nsysctl vm.max_map_count\n")])])]),s("blockquote",[s("p",[a._v("docker-compose.yml")])]),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'2'")]),a._v("  \n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("services")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("  \n     "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("elk")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("  \n       "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" sebp/elk"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("520")]),a._v("\n       "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("volumes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("  \n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" elk"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("volume"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("/var/lib/elasticsearch\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#映射目录")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" ./karaf.conf"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("/etc/logstash/conf.d/karaf.conf             \n       "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("  \n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"5044:5044"')]),a._v(" \n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"5601:5601"')]),a._v(" \n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"9200:9200"')]),a._v("  \n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"9300:9300"')]),a._v("  \n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("volumes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n     "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("elk-volume")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n")])])]),s("h3",{attrs:{id:"karaf日志输出到elk"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#karaf日志输出到elk","aria-hidden":"true"}},[a._v("#")]),a._v(" karaf日志输出到elk")]),s("p",[a._v("删除容器目录/etc/logstash/conf.d/下的文件\n新建karaf.conf")]),s("div",{staticClass:"language-conf extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v('input {\n log4j {\n mode => "server"\n port => 5044\n }\n}\noutput {\n    stdout {\n      codec => rubydebug\n    }\n    elasticsearch{\n        hosts => ["localhost:9200"]\n        index => "karaf-%{+YYYY.MM.dd}"\n        document_type => "log4j_type"\n    }\n}\n')])])]),s("p",[a._v("重启容器服务\n修改"),s("code",[a._v("karaf的etc/org.ops4j.pax.logging.cfg")]),a._v(" (对应"),s("code",[a._v("ONOS_ROOT/tools/package/etc")]),a._v(")")]),s("div",{staticClass:"language-conf extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("# Root logger\nlog4j.rootLogger=DEBUG, out, logstash,syslog, sift, osgi:*\n...\n#logstash\nlog4j.appender.logstash=org.apache.log4j.net.SocketAppender\nlog4j.appender.logstash.port=5044\nlog4j.appender.logstash.remoteHost=10.190.23.244  \n")])])]),s("h3",{attrs:{id:"filebeat输出到elk"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#filebeat输出到elk","aria-hidden":"true"}},[a._v("#")]),a._v(" filebeat输出到elk")]),s("blockquote",[s("p",[a._v("Dockerfile")])]),s("div",{staticClass:"language-docker extra-class"},[s("pre",{pre:!0,attrs:{class:"language-docker"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("From")]),a._v(" prima/filebeat\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("ADD")]),a._v(" filebeat.yml /filebeat.yml\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("RUN")]),a._v(" chmod go"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("w /filebeat.yml\n")])])]),s("blockquote",[s("p",[a._v("filebeat.yml")])]),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("filebeat")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("prospectors")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("\n            "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("paths")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n                "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"/var/onos/log/*.log"')]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("output")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("elasticsearch")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("hosts")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"10.190.23.244:9200"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n")])])]),s("blockquote",[s("p",[a._v("docker-compose.yml")])]),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'2'")]),a._v("  \n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("services")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("  \n     "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("cbb")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("  \n       "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" cbb\n       "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("volumes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("  \n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" cbb"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("volume"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("/root/onos/apache"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("karaf"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("3.0.5/data/log/\n     "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("filebeat")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n       "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" olinicola/filebeat"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("1.2.3\n       "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("volumes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("  \n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" cbb"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("volume"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("/var/onos/log/\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" ./filebeat.yml"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("/etc/filebeat/filebeat.yml\n       "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("depends_on")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" cbb\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("volumes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n     "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("cbb-volume")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n\n")])])]),s("h2",{attrs:{id:"nexus3"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#nexus3","aria-hidden":"true"}},[a._v("#")]),a._v(" nexus3")]),s("blockquote",[s("p",[a._v("docker-compose.yml")])]),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'2'")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("networks")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("neuxs-network")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("services")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("nexus3")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" sonatype/nexus3"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("latest\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("restart")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" unless"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("stopped\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("logging")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("driver")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"journald"')]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("networks")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n     "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" neuxs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("network\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n     "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"8088:8088"')]),a._v("\n     "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"8081:8081"')]),a._v("\n     "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"5000:5000"')]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("volumes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"nexus-data:/nexus-data"')]),a._v("\n  \n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("volumes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("nexus-data")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),s("h2",{attrs:{id:"onos"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#onos","aria-hidden":"true"}},[a._v("#")]),a._v(" ONOS")]),s("p",[a._v("下载"),s("code",[a._v("onosproject/onos")]),a._v("镜像")]),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("docker pull onosproject/onos\n")])])]),s("p",[a._v("自定义Dockerfile")]),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("FROM java:8-jre-alpine\nMAINTAINER wanlay\n\nRUN sed -i 's/dl-cdn.alpinelinux.org/mirrors.ustc.edu.cn/g' /etc/apk/repositories && \\\n    apk update && apk add --no-cache bash curl openssh\n\nCOPY . /root/onos/\n\nRUN   mkdir -p /root/onos/apache-karaf-3.0.5/data/log && \\\ntouch /root/onos/apache-karaf-3.0.5/data/log/karaf.log && \\\nln -sf /dev/stdout /root/onos/apache-karaf-3.0.5/data/log/karaf.log\n\nEXPOSE 6653 6640 8181 8101 9876\n\nWORKDIR /root/onos\n\nCMD [\"./bin/onos-service\"]\n")])])]),s("p",[a._v("制作docker镜像")]),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("sudo docker build -t wanlay/cbb .\n")])])]),s("p",[a._v("下载onos-form-cluster")]),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("wget")]),a._v(" https://raw.githubusercontent.com/opennetworkinglab/onos/master/tools/package/bin/onos-form-cluster \n\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("chmod")]),a._v(" u+x onos-form-cluster\n")])])]),s("p",[a._v("将下面代码加入.bashrc")]),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("docker-"),s("span",{pre:!0,attrs:{class:"token function-name function"}},[a._v("ip")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" docker inspect --format "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'{{ .NetworkSettings.IPAddress }}'")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"'),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$@")]),a._v('"')]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),s("p",[a._v("运行onos镜像")]),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("sudo docker run  -t -d --name cbb1 wanlay/cbb\n")])])]),s("p",[a._v("将多个onos实例形成集群")]),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("./onos-form-cluster -u onos -p rocks "),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")]),a._v("docker-ip cbb1"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")])]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")]),a._v("docker-ip cbb2"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")])]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")]),a._v("docker-ip cbb3"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")])]),a._v("\n")])])]),s("p",[a._v("ssh连接到onos命令行")]),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("ssh")]),a._v(" -p "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("8101")]),a._v(" onos@"),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")]),a._v("docker-ip cbb1"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")])]),a._v("  \n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#密码是rocks")]),a._v("\n")])])]),s("h2",{attrs:{id:"rancher"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#rancher","aria-hidden":"true"}},[a._v("#")]),a._v(" rancher")]),s("blockquote",[s("p",[a._v("docker-compose")])]),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'2'")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("services")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("mysqldb")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" mysql\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("restart")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" on"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("failure"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("10")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("logging")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("driver")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"journald"')]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" \n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"3306:3306"')]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("environment")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" MYSQL_ROOT_PASSWORD=root\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" MYSQL_DATABASE=rancher\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" MYSQL_USER=rancher\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" MYSQL_PASSWORD=rancher \n      \n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("rancher-server")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" rancher/server\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("restart")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" on"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("failure"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("10")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("logging")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("driver")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"journald"')]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" \n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"5555:8080"')]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("links")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" mysqldb"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("rancher\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("environment")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" db"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("user=rancher\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" db"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("pass=rancher\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" db"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("name=rancher\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" advertise"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("address=10.190.23.245   \n")])])]),s("div",{staticClass:"warning custom-block"},[s("p",{staticClass:"custom-block-title"},[a._v("WARNING")]),s("p",[a._v("添加主机时，agent所在的主机的docker版本要与server端的一样")])]),s("h2",{attrs:{id:"portainer"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#portainer","aria-hidden":"true"}},[a._v("#")]),a._v(" portainer")]),s("p",[a._v("创建集群")]),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("docker swarm init --advertise-addr 10.190.23.241\n")])])]),s("p",[a._v("运行portainer")]),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("docker service create \\\n--name portainer \\\n--publish 9000:9000 \\\n--constraint 'node.role == manager' \\\n--mount type=bind,src=//var/run/docker.sock,dst=/var/run/docker.sock \\\nportainer/portainer \\\n-H unix:///var/run/docker.sock\n")])])]),s("h2",{attrs:{id:"sonarqube"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#sonarqube","aria-hidden":"true"}},[a._v("#")]),a._v(" sonarqube")]),s("blockquote",[s("p",[a._v("docker-compose.yml")])]),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"2"')]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("services")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("sonarqube")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" sonarqube\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("restart")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" on"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("failure"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("10")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"9000:9000"')]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("networks")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" sonarnet\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("environment")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" SONARQUBE_JDBC_URL=jdbc"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("postgresql"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("//pg"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("sonarqube"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("5432/sonar\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("volumes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" sonarqube_volume"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("/opt/sonarqube\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("pg-sonarqube")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" postgres\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("restart")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" on"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("failure"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("10")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("networks")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" sonarnet\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("environment")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" POSTGRES_USER=sonar\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" POSTGRES_PASSWORD=sonar\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("volumes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" pg_sonarqube_volume"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("/var/lib/postgresql/data\n\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("networks")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("sonarnet")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("driver")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" bridge\n\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("volumes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("sonarqube_volume")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("pg_sonarqube_volume")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n")])])]),s("blockquote",[s("p",[a._v("配置LADP")])]),s("p",[a._v("sonarqube 界面上安装LDAP插件 ，或者把插件拷贝到"),s("code",[a._v("{sonarqube_volume}/extensions/plugins")]),s("br"),a._v("\n添加以下字段到"),s("code",[a._v("{sonarqube_volume}/conf/sonar.properties")])]),s("div",{staticClass:"language-conf extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("# LDAP configuration\n# General Configuration\nsonar.security.realm=LDAP\nldap.url=ldap://10.190.23.240\nldap.bindDn=cn=cbbadmin,ou=accounts,dc=fiberhome,dc=com\nldap.bindPassword=cbb2017\n \n# User Configuration\nldap.user.baseDn=ou=accounts,dc=fiberhome,dc=com\nldap.user.request=(&(objectClass=inetOrgPerson)(uid={login}))\nldap.user.realNameAttribute=cn\nldap.user.emailAttribute=mail\n \n# Group Configuration\nldap.group.baseDn=ou=groups,dc=fiberhome,dc=com\nldap.group.request=(&(objectClass=posixGroup)(memberUid={uid}))\n")])])])])}],!1,null,null,null);t.default=e.exports}}]);